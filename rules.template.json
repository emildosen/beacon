[
  {
    "_comment": "=== IDENTITY - CRITICAL CHANGES ===",
    "name": "Global Administrator role assigned",
    "source": "AuditLog",
    "operation": "Add member to role",
    "propertyPath": "ModifiedProperties",
    "operator": "Contains",
    "value": "Global Administrator",
    "severity": "Critical",
    "description": "User added to Global Administrator role"
  },
  {
    "name": "Admin role assigned",
    "source": "AuditLog",
    "operation": "Add member to role",
    "operator": "Exists",
    "severity": "High",
    "description": "User added to an administrative role"
  },
  {
    "name": "MFA disabled for user",
    "source": "AuditLog",
    "operation": "Disable Strong Authentication",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Multi-factor authentication disabled for a user"
  },
  {
    "name": "Conditional Access policy deleted",
    "source": "AuditLog",
    "operation": "Delete conditional access policy",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Conditional Access policy deleted - security controls weakened"
  },
  {
    "name": "Federation settings changed",
    "source": "AuditLog",
    "operation": "Set domain authentication",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Domain federation settings modified - potential backdoor"
  },
  {
    "name": "User password reset by admin",
    "source": "AuditLog",
    "operation": "Reset user password",
    "operator": "Exists",
    "severity": "Medium",
    "description": "Administrator reset a user's password"
  },

  {
    "_comment": "=== APPLICATIONS - OAUTH & CONSENT ===",
    "name": "OAuth app consent granted",
    "source": "AuditLog",
    "operation": "Consent to application",
    "operator": "Exists",
    "severity": "High",
    "description": "OAuth application consent granted - check for illicit consent"
  },
  {
    "name": "Application credentials added",
    "source": "AuditLog",
    "operation": "Add service principal credentials",
    "operator": "Exists",
    "severity": "High",
    "description": "New credentials added to application - verify legitimacy"
  },
  {
    "name": "App role assigned to service principal",
    "source": "AuditLog",
    "operation": "Add app role assignment to service principal",
    "operator": "Exists",
    "severity": "High",
    "description": "Application permission assigned - check scope"
  },

  {
    "_comment": "=== EXCHANGE - MAIL FORWARDING (BEC INDICATORS) ===",
    "name": "Mailbox forwarding enabled",
    "source": "AuditLog",
    "operation": "Set-Mailbox",
    "propertyPath": "Parameters.ForwardingSmtpAddress",
    "operator": "Exists",
    "severity": "Critical",
    "description": "External mail forwarding configured - BEC indicator"
  },
  {
    "name": "Inbox rule with forwarding created",
    "source": "AuditLog",
    "operation": "New-InboxRule",
    "propertyPath": "Parameters.ForwardTo",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Inbox rule forwards mail externally - BEC indicator"
  },
  {
    "name": "Inbox rule with redirect created",
    "source": "AuditLog",
    "operation": "New-InboxRule",
    "propertyPath": "Parameters.RedirectTo",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Inbox rule redirects mail - BEC indicator"
  },
  {
    "name": "Inbox rule with delete action",
    "source": "AuditLog",
    "operation": "New-InboxRule",
    "propertyPath": "Parameters.DeleteMessage",
    "operator": "Exists",
    "severity": "High",
    "description": "Inbox rule deletes messages - possible evidence hiding"
  },

  {
    "_comment": "=== EXCHANGE - PERMISSIONS ===",
    "name": "Mailbox full access granted",
    "source": "AuditLog",
    "operation": "Add-MailboxPermission",
    "operator": "Exists",
    "severity": "High",
    "description": "Full access permission granted to mailbox"
  },
  {
    "name": "Send-as permission added",
    "source": "AuditLog",
    "operation": "Add-RecipientPermission",
    "operator": "Exists",
    "severity": "High",
    "description": "Send-as permission granted - can impersonate sender"
  },

  {
    "_comment": "=== EXCHANGE - MAIL FLOW TAMPERING ===",
    "name": "Transport rule created",
    "source": "AuditLog",
    "operation": "New-TransportRule",
    "operator": "Exists",
    "severity": "High",
    "description": "Mail flow rule created - check for mail interception"
  },
  {
    "name": "Journal rule created",
    "source": "AuditLog",
    "operation": "New-JournalRule",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Email journaling rule created - mail being copied externally"
  },

  {
    "_comment": "=== EXCHANGE - SECURITY POLICY CHANGES ===",
    "name": "Anti-phishing policy changed",
    "source": "AuditLog",
    "operation": "Set-AntiPhishPolicy",
    "operator": "Exists",
    "severity": "High",
    "description": "Anti-phishing policy modified"
  },
  {
    "name": "Safe attachments policy changed",
    "source": "AuditLog",
    "operation": "Set-SafeAttachmentPolicy",
    "operator": "Exists",
    "severity": "High",
    "description": "Safe Attachments policy modified"
  },
  {
    "name": "Safe links policy changed",
    "source": "AuditLog",
    "operation": "Set-SafeLinksPolicy",
    "operator": "Exists",
    "severity": "High",
    "description": "Safe Links policy modified"
  },

  {
    "_comment": "=== EDISCOVERY - DATA EXFILTRATION ===",
    "name": "eDiscovery search exported",
    "source": "AuditLog",
    "operation": "New-ComplianceSearchAction",
    "operator": "Exists",
    "severity": "Critical",
    "description": "eDiscovery search results exported - potential data exfiltration"
  },

  {
    "_comment": "=== SHAREPOINT - EXTERNAL SHARING ===",
    "name": "Anonymous link created",
    "source": "AuditLog",
    "operation": "AnonymousLinkCreated",
    "operator": "Exists",
    "severity": "High",
    "description": "Anonymous sharing link created - data exposure risk"
  },
  {
    "name": "File malware detected",
    "source": "AuditLog",
    "operation": "FileMalwareDetected",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Malware detected in uploaded file"
  },

  {
    "_comment": "=== COMPLIANCE - PROTECTION DISABLED ===",
    "name": "DLP policy deleted",
    "source": "AuditLog",
    "operation": "Remove-DlpCompliancePolicy",
    "operator": "Exists",
    "severity": "Critical",
    "description": "DLP policy deleted - data protection removed"
  },
  {
    "name": "Audit logging config changed",
    "source": "AuditLog",
    "operation": "Set-AdminAuditLogConfig",
    "operator": "Exists",
    "severity": "Critical",
    "description": "Audit log configuration changed - possible tampering"
  },

  {
    "_comment": "=== SIGN-IN - HIGH RISK ===",
    "name": "High risk sign-in",
    "source": "SignIn",
    "propertyPath": "riskLevelDuringSignIn",
    "operator": "Equals",
    "value": "high",
    "severity": "Critical",
    "description": "High risk sign-in detected by Identity Protection"
  },
  {
    "name": "Impossible travel sign-in",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "impossibleTravel",
    "severity": "Critical",
    "description": "Impossible travel - sign-in from distant location"
  },
  {
    "name": "Anonymous IP sign-in",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "anonymizedIPAddress",
    "severity": "High",
    "description": "Sign-in from anonymous IP (VPN/Tor)"
  },
  {
    "name": "Leaked credentials detected",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "leakedCredentials",
    "severity": "Critical",
    "description": "User credentials found in breach database"
  },
  {
    "name": "Password spray attack",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "passwordSpray",
    "severity": "Critical",
    "description": "Password spray attack detected"
  },
  {
    "name": "Malware-linked IP sign-in",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "malwareInfectedIPAddress",
    "severity": "Critical",
    "description": "Sign-in from IP linked to malware"
  },
  {
    "name": "Suspicious inbox manipulation",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "suspiciousInboxForwarding",
    "severity": "Critical",
    "description": "Suspicious inbox forwarding detected post-sign-in"
  },
  {
    "name": "Anomalous token",
    "source": "SignIn",
    "propertyPath": "riskEventTypes",
    "operator": "Contains",
    "value": "anomalousToken",
    "severity": "High",
    "description": "Anomalous token detected - possible token theft"
  },

  {
    "_comment": "=== SIGN-IN - ACCOUNT ISSUES ===",
    "name": "Account locked out",
    "source": "SignIn",
    "propertyPath": "status.errorCode",
    "operator": "Equals",
    "value": "50053",
    "severity": "High",
    "description": "Account locked - possible brute force attack"
  },

  {
    "_comment": "=== SECURITY ALERTS - DEFENDER ===",
    "name": "High severity security alert",
    "source": "SecurityAlert",
    "propertyPath": "severity",
    "operator": "Equals",
    "value": "high",
    "severity": "Critical",
    "description": "High severity Microsoft Defender alert"
  },
  {
    "name": "Medium severity security alert",
    "source": "SecurityAlert",
    "propertyPath": "severity",
    "operator": "Equals",
    "value": "medium",
    "severity": "High",
    "description": "Medium severity Microsoft Defender alert"
  },
  {
    "name": "Ransomware activity",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "Ransomware",
    "severity": "Critical",
    "description": "Potential ransomware activity detected"
  },
  {
    "name": "Malware detected",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "Malware",
    "severity": "Critical",
    "description": "Malware detected by Microsoft Defender"
  },
  {
    "name": "Credential theft activity",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "CredentialAccess",
    "severity": "Critical",
    "description": "Credential theft activity detected"
  },
  {
    "name": "Lateral movement",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "LateralMovement",
    "severity": "Critical",
    "description": "Lateral movement detected"
  },
  {
    "name": "Data exfiltration",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "Exfiltration",
    "severity": "Critical",
    "description": "Potential data exfiltration detected"
  },
  {
    "name": "Privilege escalation",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "PrivilegeEscalation",
    "severity": "Critical",
    "description": "Privilege escalation detected"
  },
  {
    "name": "Command and control",
    "source": "SecurityAlert",
    "propertyPath": "category",
    "operator": "Contains",
    "value": "CommandAndControl",
    "severity": "Critical",
    "description": "Command and control activity detected"
  },

  {
    "_comment": "=== CLIENT-SPECIFIC ===",
    "name": "Emergency access account sign-in (TEMPLATE)",
    "source": "SignIn",
    "propertyPath": "userPrincipalName",
    "operator": "Equals",
    "value": "breakglass@contoso.com",
    "severity": "Critical",
    "description": "Emergency/break-glass account was used to sign in",
    "tenantIds": ["00000000-0000-0000-0000-000000000000"]
  }
]